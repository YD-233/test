import{u as S,a as k,r as m,_ as B}from"./index-88aec585.js";/* empty css                  *//* empty css                   *//* empty css                     *//* empty css                 */import{U as C}from"./index-2411daa7.js";import{y as N,x as q,z as I,o as z,p as A,a as u}from"./element-61b2a7f7.js";import{H as D,r as f,_ as c,e as g,l as M,m as T,V as o,P as r,p as $,T as V}from"./vue-95bbca75.js";const H={class:"dialog-footer"},p="140px",L=D({__name:"ResetPassword",setup(W){const i=S(),b=k(),l=f(!0),e=c({username:i.getUserName()||"",password:"",new_password:"",again_password:""});e.username||m.push("/401");const v=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[^]{8,}$/,h=g(()=>v.test(e.new_password)),x=g(()=>e.new_password===e.again_password),_=f(),U=c({password:[{required:!0,message:"请输入原密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新密码",trigger:"change"},{min:8,message:"新密码长度大于等于8位",trigger:"blur"}],again_password:[{required:!0,message:"请输入确认密码",trigger:"change"},{min:8,message:"确认密码长度大于等于8位",trigger:"blur"}]}),P=()=>{if(!h.value){u.error("密码强度不符合要求，必须包含大小写字母和数字，且长度大于8位");return}if(!x.value){u.error("确认密码与新密码不一致");return}C.rest_password({old_password:e.password,new_password:e.new_password}).then(t=>{t.data.code==200?(u.success("重置成功"),l.value=!1,i.logout(),b.clear(),localStorage.clear(),sessionStorage.clear(),m.push("/login")):(u.error("重置密码失败，请稍后重试"),l.value=!1)})},y=()=>{l.value=!1,m.push("/dashboard")},E=t=>{t&&t.validate((s,d)=>{if(s)P();else return!1})};return(t,s)=>{const d=N,n=q,F=I,w=z,R=A;return M(),T("div",null,[o(R,{modelValue:l.value,"onUpdate:modelValue":s[5]||(s[5]=a=>l.value=a),title:"重置密码"},{footer:r(()=>[$("span",H,[o(w,{onClick:y},{default:r(()=>[V("取消")]),_:1}),o(w,{type:"primary",onClick:s[4]||(s[4]=a=>E(_.value))},{default:r(()=>[V("确定")]),_:1})])]),default:r(()=>[o(F,{ref_key:"ruleFormRef",ref:_,model:e,class:"reset_password_form",rules:U},{default:r(()=>[o(n,{label:"用户名：","label-width":p},{default:r(()=>[o(d,{modelValue:e.username,"onUpdate:modelValue":s[0]||(s[0]=a=>e.username=a),autocomplete:"off",readonly:""},null,8,["modelValue"])]),_:1}),o(n,{label:"原密码：","label-width":p,prop:"password"},{default:r(()=>[o(d,{modelValue:e.password,"onUpdate:modelValue":s[1]||(s[1]=a=>e.password=a),autocomplete:"off",minlength:"8",clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),o(n,{label:"新密码：","label-width":p,prop:"new_password"},{default:r(()=>[o(d,{modelValue:e.new_password,"onUpdate:modelValue":s[2]||(s[2]=a=>e.new_password=a),autocomplete:"off",minlength:8,clearable:"","show-password":""},null,8,["modelValue"])]),_:1}),o(n,{label:"确认密码：","label-width":p,prop:"again_password"},{default:r(()=>[o(d,{modelValue:e.again_password,"onUpdate:modelValue":s[3]||(s[3]=a=>e.again_password=a),autocomplete:"off",minlength:8,clearable:"","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}});const Y=B(L,[["__scopeId","data-v-6a9d80e1"]]);export{Y as default};
