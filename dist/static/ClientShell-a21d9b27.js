import{_ as C}from"./index-88aec585.js";/* empty css                 */import{ax as g,aB as y,r as c,d as x,Z as S,l as B,m as H,p as V,U as w,V as E,a9 as h,a3 as u}from"./vue-95bbca75.js";import{C as m}from"./index-926bd281.js";import{y as K,a as T}from"./element-61b2a7f7.js";const N=g("commandHistory",{state:()=>({histories:{},currentIndices:{}}),actions:{addCommand(e,s){s.trim()&&(!this.histories[e]||this.histories[e][this.histories[e].length-1]!==s)&&(this.histories[e]||(this.histories[e]=[]),this.histories[e].push(s),this.currentIndices[e]=-1)},getPrevCommand(e){if(!(!this.histories[e]||this.histories[e].length===0)&&(this.currentIndices[e]===-1&&(this.currentIndices[e]=this.histories[e].length),this.currentIndices[e]>0))return this.currentIndices[e]--,this.histories[e][this.currentIndices[e]]},getNextCommand(e){if(!(!this.histories[e]||this.histories[e].length===0))return this.currentIndices[e]>=0&&this.currentIndices[e]<this.histories[e].length-1?(this.currentIndices[e]++,this.histories[e][this.currentIndices[e]]):(this.currentIndices[e]=-1,"")},clearCurrentIndex(e){this.currentIndices[e]=-1},clearHistory(e){this.histories[e]&&(delete this.histories[e],delete this.currentIndices[e])}}});const M={class:"terminal"},P={id:"output",class:"output"},U={__name:"ClientShell",setup(e){const s=N(),p=y(),r=c(""),a=c(""),o=c(""),i=String(p.query.uid),v=async()=>{if(r.value.trim()==="")return;const t=r.value.trim();r.value="",s.addCommand(i,t),s.clearCurrentIndex(i);try{m.send_commands({uid:i,command:t}).then(n=>{if(o.value=n.data.data,a.value!==o.value){a.value=o.value;const l=document.getElementById("output");setTimeout(()=>{l.scrollTop=l.scrollHeight},1)}})}catch{T.error("命令执行失败")}},_=()=>{const t=s.getPrevCommand(i);t!==void 0&&(r.value=t)},f=()=>{const t=s.getNextCommand(i);t!==void 0&&(r.value=t)};function d(){m.get_shellcontent({uid:i}).then(t=>{if(o.value=t.data.data,a.value!==o.value){a.value=o.value;const n=document.getElementById("output");setTimeout(()=>{n.scrollTop=n.scrollHeight},1)}})}return x(()=>{d();const t=setInterval(d,5e3);S(()=>{clearInterval(t)})}),(t,n)=>{const l=K;return B(),H("div",M,[V("div",P,w(a.value),1),E(l,{modelValue:r.value,"onUpdate:modelValue":n[0]||(n[0]=I=>r.value=I),placeholder:"输入命令...",onKeyup:h(v,["enter"]),onKeydown:[h(u(_,["prevent"]),["up"]),h(u(f,["prevent"]),["down"])],ref:"input"},null,8,["modelValue","onKeyup","onKeydown"])])}}},R=C(U,[["__scopeId","data-v-81458c10"]]);export{R as default};
