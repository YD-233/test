import"./index-88aec585.js";/* empty css                 *//* empty css                    *//* empty css                    *//* empty css               */import{H as y,aB as g,r as C,d as x,Z as P,l as B,O as v,P as o,V as n,p,U as u,T as E}from"./vue-95bbca75.js";import{C as b}from"./index-926bd281.js";import{b as D,a as r,t as N,L as T,o as U,u as k}from"./element-61b2a7f7.js";const $=y({__name:"ClientDownloads",setup(I){const h=g(),f=C([]),m=h.query.uid,w=t=>{D.confirm(`是否下载文件：${t.fileName}?`,"下载确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{r.warning("后台下载中，请勿关闭客户端，并保持网络畅通");try{const l=await b.download_downloaded_file({uid:m,filePath:t.filePath});if(l.status==200){r.success("导出成功");const a=l.headers["content-disposition"]||"",s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(a);let c=s&&s.length>1?decodeURIComponent(s[1].replace(/['"]/g,"")):"exported_file",d=new Blob([l.data],{type:l.headers["content-type"]}),e=document.createElement("a"),i=window.URL.createObjectURL(d);e.href=i,e.download=c,document.body.appendChild(e),e.click(),document.body.removeChild(e),window.URL.revokeObjectURL(i)}else r.error("导出失败，请稍后重试")}catch{r.error("下载"+t.filePath+"失败")}}).catch(()=>{r.info("已取消下载")})},_=async()=>{const t=await b.get_downloads_info({uid:m});t.data.status===200&&(f.value=t.data.data)};return x(()=>{_();const t=setInterval(_,2e3);P(()=>{clearInterval(t)})}),(t,l)=>{const a=N,s=T,c=U,d=k;return B(),v(d,{style:{width:"100%"},data:f.value},{default:o(()=>[n(a,{prop:"fileName",label:"文件名",sortable:""},{default:o(({row:e})=>[p("span",null,u(e.fileName),1)]),_:1}),n(a,{prop:"filePath",label:"文件路径",sortable:""},{default:o(({row:e})=>[p("span",null,u(e.filePath),1)]),_:1}),n(a,{prop:"fileSize",label:"文件大小",sortable:""},{default:o(({row:e})=>[p("span",null,u(e.fileSize),1)]),_:1}),n(a,{prop:"downloadPart",label:"下载进度",sortable:""},{default:o(({row:e})=>[n(s,{percentage:e.downloadPart,"show-text":!0},null,8,["percentage"])]),_:1}),n(a,{prop:"option",label:"操作"},{default:o(({row:e})=>[n(c,{onClick:i=>w(e),type:"primary",size:"small"},{default:o(()=>[E("下载")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])}}});export{$ as default};
